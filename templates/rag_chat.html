{% extends "base.html" %}
{% block title %}RAG Chat - Study Coach{% endblock %}
{% block content %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<div class="container mt-5">
  <h2 class="text-center text-primary mb-4">
    <i class="bi bi-chat-left-text"></i> Ask Your Notes
  </h2>

  <div class="row justify-content-center">
    <div class="col-md-8">
      <!-- Chat Window -->
      <div
        id="chatWindow"
        class="border rounded p-3 mb-3"
        style="height: 400px; overflow-y: auto; background-color: #f8f9fa"
      >
        <!-- Chat messages will appear here -->
      </div>

      <!-- Input -->
      <div class="input-group">
        <input
          type="text"
          id="query"
          class="form-control"
          placeholder="Type your question..."
        />
        <button id="askBtn" class="btn btn-danger">
          <i class="bi bi-send"></i> Ask
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  function appendMessage(sender, message) {
    const chatWindow = $("#chatWindow");
    const msgDiv = $(`
      <div class="mb-2">
        <strong>${sender}:</strong> ${message}
      </div>
    `);
    chatWindow.append(msgDiv);
    chatWindow.scrollTop(chatWindow[0].scrollHeight); // auto-scroll
  }

  $(document).ready(function () {
    $("#askBtn").click(function () {
      const query = $("#query").val().trim();
      if (!query) return;

      appendMessage("You", query);
      $("#query").val("");

      $.post("/ask_rag", { query: query }, function (data) {
        appendMessage("RAG Bot", data.answer);
      });
    });

    // Allow Enter key to send message
    $("#query").keypress(function (e) {
      if (e.which === 13) {
        $("#askBtn").click();
      }
    });
  });
</script>

<style>
  #chatWindow div {
    padding: 6px 10px;
    border-radius: 8px;
  }

  #chatWindow div:nth-child(odd) {
    background-color: #d1ecf1;
    text-align: left;
  }

  #chatWindow div:nth-child(even) {
    background-color: #f8d7da;
    text-align: left;
  }
</style>

{% endblock %}